# I2C_Controller

### 项目介绍
* I2C控制器
    * 系统时钟和I2C时钟可配置；
    * 单字节或双字节寄存器地址可配置；
    * 单次读写或循环读写可配置。


### 接口说明

* clk：系统时钟       
* rst_n：异步复位        

* device_addr：设备地址（8bit格式）；
* word_addr_h：双字节word地址高8bit；
* word_addr_l：双字节word地址低8bit或单字节word地址；

* num_word_addr：word地址宽度，0为八位，1为十六位；
* num_data_w：写数据(8bit)的个数（num_data_w+1）；  
* num_data_r：读数据(8bit)的个数（num_data_r+1）；  

* wen：写使能；      
* wdata：写数据；      
* wvalid：写数据有效（写完一个8bit数据会保持一个周期上升沿）；

* ren：读使能；
* rdata：读数据；
* rvalid：读数据有效（读完一个8bit数据会保持一个周期上升沿）；

* ready：准备好传输；
* done：传输完成；
* error：传输有误；

* scl：scl；
* sda：sda。         


### 时序

#### 综述
* scl为时钟信号，不传输数据时拉高；
* sda为数据信号，scl为低时变化，scl为高时稳定；
* 写数据传输：
    * 起始信号；
    * 传输七位器件地址（device_addr）和一位写（低）信号；
    * 等待一位应答（ACK）信号；
    * 确定寄存器地址；
        * 两字节寄存器：
            * 传输高八位寄存器地址；
            * 等待一位应答（ACK）信号（低）；
            * 传输低八位寄存器地址：
            * 等待一位应答（ACK）信号（低）；
        * 单字节寄存器：
            * 传输八位寄存器地址；
            * 等待一位应答（ACK）信号（低）；
    * 传输数据；
        * 单次写入：
            * 传输八位数据信号；
            * 等待一位应答（ACK）信号（低）；
        * 多次写入：
            * 传输八位数据信号；
            * 等待一位应答（ACK）信号（低）；
            * 循环以上步骤；
    * 停止位；
* 读数据传输：
    * 起始信号；
    * 传输七位器件地址（device_addr）和一位写（低）信号；
    * 等待一位应答（ACK）信号；
    * 确定寄存器地址；
        * 两字节寄存器：
            * 传输高八位寄存器地址；
            * 等待一位应答（ACK）信号；
            * 传输低八位寄存器地址：
            * 等待一位应答（ACK）信号；
        * 单字节寄存器：
            * 传输八位寄存器地址；
            * 等待一位应答（ACK）信号；
    * 起始信号；
    * 传输七位器件地址（device_addr）和一位读（高）信号；
    * 传输数据；
        * 单次读取：
            * 传输八位数据信号；
            * 输出一位应答（ACK）信号（高）；
        * 多次读取：
            * 传输八位数据信号；
            * 输出一位应答（ACK）信号（低）；
            * 循环以上步骤；
            * 传输最后一组八位数据信号；
            * 输出一位应答（ACK）信号（高），或释放sda被拉高；
    * 停止位。
    


#### 起始信号

scl:\_\_\_\_/￣￣\\_____          
sda:￣￣￣\\________

#### 停止信号

scl:\_\_\_\_/￣￣\\_____          
sda:\_\_\_\_\_\_/￣￣￣


#### 单字节寄存器单次写时序

| 起始位 | DA6 | DA5 | DA4 | DA3 | DA2 | DA1 | DA0 | Write | ACK | RA7 | RA6 | RA5 | RA4 | RA3 | RA2| RA1 | RA0 | ACK | D7 | D6 | D5 | D4 | D3 | D2 | D1 | D0 | ACK | 停止位 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| M | M | M | M | M | M | M | M | M | S | M | M | M | M | M | M | M | M | S | M | M | M | M | M | M | M | M | S | M |




